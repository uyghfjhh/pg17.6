# PostgreSQL 17 æ–°ç‰¹æ€§æºç åˆ†æ

> æ·±å…¥åˆ†æPostgreSQL 17ç›¸æ¯”16çš„æ ¸å¿ƒæ–°ç‰¹æ€§

**ç‰ˆæœ¬**: PostgreSQL 17.6 vs 16.x  
**å‘å¸ƒæ—¥æœŸ**: 2024-09-26  
**åˆ†æç»´åº¦**: æ ¸å¿ƒåŠŸèƒ½ | æ ¸å¿ƒæµç¨‹ | æ ¸å¿ƒæºç  | æ ¸å¿ƒç®—æ³• | æ¶æ„å›¾è§£

---

## ğŸ“‘ ç›®å½•ç»“æ„

```
pg17_new_features/
â”œâ”€â”€ README.md                           # æœ¬æ–‡ä»¶
â”œâ”€â”€ 00_overview.md                      # æ–°ç‰¹æ€§æ€»è§ˆ
â”‚
â”œâ”€â”€ 01_vacuum_memory_management/        # VACUUMå†…å­˜ç®¡ç†ä¼˜åŒ–
â”‚   â”œâ”€â”€ 01_overview.md                  # åŠŸèƒ½æ¦‚è¿°
â”‚   â”œâ”€â”€ 02_architecture.md              # æ¶æ„è®¾è®¡
â”‚   â”œâ”€â”€ 03_source_code_analysis.md      # æºç åˆ†æ
â”‚   â””â”€â”€ 04_performance_impact.md        # æ€§èƒ½å½±å“
â”‚
â”œâ”€â”€ 02_sql_json/                        # SQL/JSONå¢å¼º
â”‚   â”œâ”€â”€ 01_json_constructors.md         # JSONæ„é€ å‡½æ•°
â”‚   â”œâ”€â”€ 02_json_table.md                # JSON_TABLE()å‡½æ•°
â”‚   â””â”€â”€ 03_source_analysis.md           # æºç åˆ†æ
â”‚
â”œâ”€â”€ 03_performance_improvements/        # æ€§èƒ½æ”¹è¿›
â”‚   â”œâ”€â”€ 01_streaming_io.md              # æµå¼I/O
â”‚   â”œâ”€â”€ 02_btree_multi_value.md         # B-treeå¤šå€¼æœç´¢
â”‚   â””â”€â”€ 03_high_concurrency_write.md    # é«˜å¹¶å‘å†™å…¥
â”‚
â”œâ”€â”€ 04_logical_replication/             # é€»è¾‘å¤åˆ¶å¢å¼º
â”‚   â”œâ”€â”€ 01_failover_control.md          # æ•…éšœè½¬ç§»æ§åˆ¶
â”‚   â”œâ”€â”€ 02_pg_createsubscriber.md       # pg_createsubscriberå·¥å…·
â”‚   â””â”€â”€ 03_pg_upgrade_slots.md          # pg_upgradeä¿ç•™slot
â”‚
â”œâ”€â”€ 05_backup_enhancements/             # å¤‡ä»½å¢å¼º
â”‚   â”œâ”€â”€ 01_incremental_backup.md        # å¢é‡å¤‡ä»½
â”‚   â””â”€â”€ 02_source_analysis.md           # æºç åˆ†æ
â”‚
â”œâ”€â”€ 06_connection_improvements/         # è¿æ¥æ”¹è¿›
â”‚   â”œâ”€â”€ 01_direct_ssl_negotiation.md    # ç›´æ¥TLSæ¡æ‰‹
â”‚   â””â”€â”€ 02_performance_analysis.md      # æ€§èƒ½åˆ†æ
â”‚
â”œâ”€â”€ 07_copy_enhancements/               # COPYå¢å¼º
â”‚   â”œâ”€â”€ 01_on_error_ignore.md           # ON_ERROR ignoreé€‰é¡¹
â”‚   â””â”€â”€ 02_use_cases.md                 # ä½¿ç”¨åœºæ™¯
â”‚
â”œâ”€â”€ 08_other_features/                  # å…¶ä»–æ–°ç‰¹æ€§
â”‚   â”œâ”€â”€ 01_search_path_safety.md        # search_pathå®‰å…¨æ€§
â”‚   â”œâ”€â”€ 02_removed_features.md          # ç§»é™¤çš„ç‰¹æ€§
â”‚   â””â”€â”€ 03_minor_improvements.md        # å…¶ä»–æ”¹è¿›
â”‚
â””â”€â”€ 99_summary/                         # æ€»ç»“
    â”œâ”€â”€ 01_feature_matrix.md            # ç‰¹æ€§å¯¹æ¯”çŸ©é˜µ
    â”œâ”€â”€ 02_upgrade_guide.md             # å‡çº§æŒ‡å—
    â””â”€â”€ 03_performance_benchmark.md     # æ€§èƒ½åŸºå‡†æµ‹è¯•
```

---

## ğŸ¯ PostgreSQL 17 ä¸»è¦æ–°ç‰¹æ€§

### 1. **VACUUMå†…å­˜ç®¡ç†ä¼˜åŒ–** ğŸ”¥
- **é‡è¦æ€§**: â­â­â­â­â­
- **æ ¸å¿ƒæ”¹è¿›**: å…¨æ–°çš„å†…å­˜ç®¡ç†ç³»ç»Ÿ
- **æ€§èƒ½æå‡**: å¤§å¹…å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œæå‡æ•´ä½“VACUUMæ€§èƒ½
- **æºç ä½ç½®**: `src/backend/access/heap/vacuumlazy.c`
- **åˆ†æé‡ç‚¹**: 
  - æ–°çš„å†…å­˜åˆ†é…ç­–ç•¥
  - TIDå­˜å‚¨ä¼˜åŒ–
  - å†…å­˜ä½¿ç”¨æ¨¡å¼å˜åŒ–

### 2. **SQL/JSONå¢å¼º** ğŸ†•
- **é‡è¦æ€§**: â­â­â­â­
- **æ–°å¢åŠŸèƒ½**:
  - JSONæ„é€ å‡½æ•°
  - JSONæ ‡è¯†å‡½æ•°
  - **JSON_TABLE()** - å°†JSONè½¬æ¢ä¸ºè¡¨
- **æºç ä½ç½®**: `src/backend/utils/adt/json*.c`, `src/backend/executor/`
- **åˆ†æé‡ç‚¹**:
  - JSON_TABLE()å®ç°åŸç†
  - å¢é‡JSONè§£æå™¨
  - æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 3. **æŸ¥è¯¢æ€§èƒ½æ”¹è¿›** âš¡
- **é‡è¦æ€§**: â­â­â­â­â­
- **æ ¸å¿ƒä¼˜åŒ–**:
  - **æµå¼I/O** - é¡ºåºè¯»å–ä¼˜åŒ–
  - **é«˜å¹¶å‘å†™å…¥** - æå‡å†™å…¥ååé‡
  - **B-treeå¤šå€¼æœç´¢** - INæŸ¥è¯¢ä¼˜åŒ–
- **æºç ä½ç½®**: 
  - `src/backend/storage/smgr/`
  - `src/backend/access/nbtree/`
- **åˆ†æé‡ç‚¹**:
  - æµå¼I/Oå®ç°æœºåˆ¶
  - å¹¶å‘æ§åˆ¶ä¼˜åŒ–
  - ç´¢å¼•æœç´¢ç®—æ³•æ”¹è¿›

### 4. **é€»è¾‘å¤åˆ¶å¢å¼º** ğŸ”„
- **é‡è¦æ€§**: â­â­â­â­
- **æ–°å¢åŠŸèƒ½**:
  - **æ•…éšœè½¬ç§»æ§åˆ¶** - ä¸»ä»åˆ‡æ¢ç®¡ç†
  - **pg_createsubscriber** - ä»ç‰©ç†standbyåˆ›å»ºé€»è¾‘å‰¯æœ¬
  - **pg_upgradeä¿ç•™slot** - å‡çº§ä¿æŒå¤åˆ¶çŠ¶æ€
- **æºç ä½ç½®**: 
  - `src/backend/replication/logical/`
  - `src/bin/pg_createsubscriber/`
- **åˆ†æé‡ç‚¹**:
  - æ•…éšœè½¬ç§»æœºåˆ¶
  - ç‰©ç†åˆ°é€»è¾‘è½¬æ¢æµç¨‹
  - slotæŒä¹…åŒ–

### 5. **å¢é‡å¤‡ä»½** ğŸ’¾
- **é‡è¦æ€§**: â­â­â­â­
- **æ ¸å¿ƒåŠŸèƒ½**: pg_basebackupæ”¯æŒå¢é‡å¤‡ä»½
- **æºç ä½ç½®**: `src/bin/pg_basebackup/`
- **åˆ†æé‡ç‚¹**:
  - å¢é‡å¤‡ä»½ç®—æ³•
  - å—çº§åˆ«å˜æ›´è·Ÿè¸ª
  - æ¢å¤æµç¨‹

### 6. **è¿æ¥ä¼˜åŒ–** ğŸ”Œ
- **é‡è¦æ€§**: â­â­â­
- **æ–°å¢é€‰é¡¹**: `sslnegotiation=direct`
- **æ€§èƒ½æå‡**: é¿å…ä¸€æ¬¡å¾€è¿”åå•†ï¼Œç›´æ¥TLSæ¡æ‰‹
- **æºç ä½ç½®**: `src/interfaces/libpq/`
- **åˆ†æé‡ç‚¹**:
  - æ¡æ‰‹æµç¨‹ä¼˜åŒ–
  - å»¶è¿Ÿå‡å°‘åˆ†æ

### 7. **COPYå®¹é”™** ğŸ“
- **é‡è¦æ€§**: â­â­â­
- **æ–°å¢é€‰é¡¹**: `ON_ERROR ignore`
- **åŠŸèƒ½**: é‡åˆ°é”™è¯¯ç»§ç»­æ‰§è¡ŒCOPY
- **æºç ä½ç½®**: `src/backend/commands/copy*.c`
- **åˆ†æé‡ç‚¹**:
  - é”™è¯¯å¤„ç†æœºåˆ¶
  - æ•°æ®ä¸€è‡´æ€§ä¿è¯

### 8. **å…¶ä»–æ”¹è¿›**
- **search_pathå®‰å…¨æ€§** - ç»´æŠ¤æ“ä½œä½¿ç”¨å®‰å…¨è·¯å¾„
- **ç§»é™¤çš„ç‰¹æ€§** - old_snapshot_thresholdç­‰
- **å…¼å®¹æ€§å˜åŒ–** - å‡çº§æ³¨æ„äº‹é¡¹

---

## ğŸ“Š åˆ†ææ–¹æ³•è®º

æ¯ä¸ªæ–°ç‰¹æ€§çš„åˆ†æéµå¾ªä»¥ä¸‹ç»“æ„ï¼š

### 1. åŠŸèƒ½æ¦‚è¿°
- **èƒŒæ™¯**: ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç‰¹æ€§ï¼Ÿ
- **ç›®æ ‡**: è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ
- **ç”¨æˆ·ä»·å€¼**: å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ

### 2. æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç³»ç»Ÿæ¶æ„å›¾                  â”‚
â”‚  (ä½¿ç”¨ASCIIå›¾å±•ç¤ºç»„ä»¶å…³ç³»)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- ç»„ä»¶å…³ç³»
- æ•°æ®æµ
- äº¤äº’æµç¨‹

### 3. æ ¸å¿ƒæºç åˆ†æ
```c
/* 
 * å…³é”®å‡½æ•°åˆ†æ
 * é€è¡Œæ³¨é‡Šè§£é‡Š
 */
ReturnType FunctionName(Args) {
    // è¯¦ç»†ä¸­æ–‡æ³¨é‡Š
    // è§£é‡Šæ¯ä¸ªæ­¥éª¤
    // è¯´æ˜è®¾è®¡è€ƒè™‘
}
```
- å…³é”®å‡½æ•°
- æ•°æ®ç»“æ„
- ç®—æ³•å®ç°

### 4. æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1â”‚ â”€â”€â†’ â”‚ æ­¥éª¤2â”‚ â”€â”€â†’ â”‚ æ­¥éª¤3â”‚
â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜
```

### 5. æ€§èƒ½åˆ†æ
- åŸºå‡†æµ‹è¯•
- æ€§èƒ½å¯¹æ¯”
- ä¼˜åŒ–æ•ˆæœ
- é€‚ç”¨åœºæ™¯

### 6. ä½¿ç”¨ç¤ºä¾‹
- SQLç¤ºä¾‹
- é…ç½®æ–¹æ³•
- æœ€ä½³å®è·µ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æŸ¥çœ‹ç‰¹æ€§æ€»è§ˆ
```bash
cd /home/postgres/pg17.6/studydoc/pg17_new_features
less 00_overview.md
```

### æ·±å…¥æŸä¸ªç‰¹æ€§
```bash
# ä¾‹å¦‚ï¼šåˆ†æVACUUMå†…å­˜ç®¡ç†
cd 01_vacuum_memory_management
less 01_overview.md
less 03_source_code_analysis.md
```

### æŸ¥çœ‹æºç 
```bash
# æŸ¥çœ‹VACUUMç›¸å…³æºç 
cd /home/postgres/pg17.6/src/backend/access/heap
less vacuumlazy.c

# æŸ¥çœ‹JSON_TABLEå®ç°
cd /home/postgres/pg17.6/src/backend/executor
grep -r "JSON_TABLE" .
```

---

## ğŸ“ˆ åˆ†æè¿›åº¦

- [ ] 00. æ–°ç‰¹æ€§æ€»è§ˆ
- [ ] 01. VACUUMå†…å­˜ç®¡ç†ä¼˜åŒ– â­â­â­â­â­
- [ ] 02. SQL/JSONå¢å¼º
- [ ] 03. æ€§èƒ½æ”¹è¿›ï¼ˆæµå¼I/Oã€B-treeã€å¹¶å‘ï¼‰
- [ ] 04. é€»è¾‘å¤åˆ¶å¢å¼º
- [ ] 05. å¢é‡å¤‡ä»½
- [ ] 06. è¿æ¥ä¼˜åŒ–
- [ ] 07. COPYå¢å¼º
- [ ] 08. å…¶ä»–ç‰¹æ€§
- [ ] 99. æ€»ç»“å’Œå¯¹æ¯”

---

## ğŸ¯ ä¼˜å…ˆçº§

**P0 (å¿…é¡»åˆ†æ):**
1. VACUUMå†…å­˜ç®¡ç†ä¼˜åŒ– - æ ¸å¿ƒæ€§èƒ½æ”¹è¿›
2. æµå¼I/O - æŸ¥è¯¢æ€§èƒ½æå‡
3. B-treeå¤šå€¼æœç´¢ - INæŸ¥è¯¢ä¼˜åŒ–

**P1 (é‡è¦åˆ†æ):**
4. JSON_TABLE() - æ–°SQLæ ‡å‡†åŠŸèƒ½
5. å¢é‡å¤‡ä»½ - é‡è¦è¿ç»´ç‰¹æ€§
6. é€»è¾‘å¤åˆ¶å¢å¼º - é«˜å¯ç”¨æ”¹è¿›

**P2 (å¯é€‰åˆ†æ):**
7. è¿æ¥ä¼˜åŒ–
8. COPYå®¹é”™
9. å…¶ä»–æ”¹è¿›

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **å®˜æ–¹æ–‡æ¡£**: https://www.postgresql.org/docs/17/release-17.html
- **æºç **: /home/postgres/pg17.6/
- **Release Notes**: /home/postgres/pg17.6/doc/src/sgml/release-17.sgml
- **Commitæ—¥å¿—**: https://git.postgresql.org/

---

## ğŸ”§ å·¥å…·å’Œæ–¹æ³•

### æºç æœç´¢
```bash
# æœç´¢ç‰¹å®šåŠŸèƒ½
grep -r "function_name" /home/postgres/pg17.6/src/

# æŸ¥çœ‹æäº¤å†å²
git log --grep="keyword" --oneline
```

### æ€§èƒ½æµ‹è¯•
```bash
# ä½¿ç”¨pgbenchæµ‹è¯•
pgbench -i -s 100 testdb
pgbench -c 10 -j 4 -T 60 testdb
```

### å¯¹æ¯”åˆ†æ
```bash
# å¯¹æ¯”PG 16å’Œ17çš„ä»£ç å·®å¼‚
diff -u pg16/src/backend/access/heap/vacuumlazy.c \
        pg17/src/backend/access/heap/vacuumlazy.c
```

---

**å¼€å§‹ä½ çš„PostgreSQL 17æ–°ç‰¹æ€§æºç åˆ†æä¹‹æ—…ï¼** ğŸ“

**ç‰ˆæœ¬**: PostgreSQL 17.6  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-17  
**åˆ†ææ–¹æ³•**: æ ¸å¿ƒåŠŸèƒ½ + æ ¸å¿ƒæµç¨‹ + æ ¸å¿ƒæºç  + æ ¸å¿ƒç®—æ³• + æ¶æ„å›¾è§£

